<!DOCTYPE html> 
<html> 
	<head> 
	<title>Watch List</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/scu.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile.structure-1.3.1.min.css" /> 
	<link rel="stylesheet" href="assets/secondary.css" />
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script> 
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script> 

	<script>
	   $(document).ready(function() {
	   	if($('#primary-nav').length == 0) {
	   		$('.pnav-icon').hide();
	   		}
	   });
   
	   
		function getUrlVars() {
		var vars = [], hash;
		var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
		for(var i = 0; i < hashes.length; i++)
		    {
		        hash = hashes[i].split('=');
		        vars.push(hash[0]);
		        vars[hash[0]] = hash[1];
		    }
		return vars;
		}
		

	</script>
   
	</head> 
<body> 

<div data-role="page" class="navpage type-interior" data-theme="a">
	
	<div data-role="header">
		<a rel="external" href="index.html" data-role="none" data-direction="reverse" class="ui-btn-left"><img width="108" height="40" class="sculogo" alt="" src="assets/scu-home.png" /></a>
		<h1>Watch List</h1>
		<a href="#" onclick="$.mobile.silentScroll($.mobile.activePage.find('#primary-nav').position().top)" data-role="none" class="pnav-icon"><img alt="" src="assets/259-list-w.png" /></a>
	</div><!-- /header -->

	<div data-role="content">
		<div class="content-primary">
			<ul id="subjects" data-role="listview" class="ui-listview"></ul>
			<script type="text/javascript">
				var sstr = '';
				
				if (localStorage && localStorage.getItem('watchList')) {
					// clear watchlist contents from local storage
					//localStorage.removeItem('watchList');
					//var wl = '';
					var wl = localStorage.getItem('watchList').split(",");
					} else {
					localStorage.setItem('watchList','');
					var wl = new Array();
				}
				
				function watchlistSave(c) {
					wl.push(c);
					localStorage.setItem('watchList',wl);
					//alert(localStorage.getItem('watchList'));
				}
				
				function watchlistDel(c) {
					var cid = wl.indexOf(c);
					delete wl[cid];
					localStorage.setItem('watchList',wl);
					//alert(c + ' ' + localStorage.getItem('watchList'));
				}
				
				function include(arr,obj) {
					return (arr.indexOf(obj) != -1);
				}

				jQuery.each(wl, function(index, item) {
					var tc = item.split('-');
					jQuery(function($){
				    	$.ajax({
				            url: "http://test01.scu.edu/docs/ws/catalog/index.cfc?method=qClass&classnbr="+tc[1]+"&strm="+tc[0]+"&ReturnFormat=json",
				            dataType: 'json',
				            async:false,
				            success: function(response) {
				            	var i;
				            	var lterm = '';
				            	
				            	//["CRSE_ID","CLASS_NBR","STRM","STRM_DESCR","CAREER_DESCR","GROUP_DESCR","ACAD_CAREER","SUBJECT","8 SUBJECT_DESCR","ACAD_GROUP","CLASS_DESCR","11 DAYS","TIME_START","TIME_END","FACILITY","INSTRUCTOR","UNITS","TITLE","18 CATALOG_NBR","SUBCAT","SESSION_CODE","SESSION_DESCR","SEATS"]
				            	for (i = 0; i < response.DATA.length; i++) {
				            		//if (lterm != response.DATA[i][3]) {
				            			//sstr += '<li data-role="list-divider">' + response.DATA[i][3] + ' - ' + response.DATA[i][4] + '</li>';
				            			//lterm = response.DATA[i][3];
				            			//}
				            		var wlid = response.DATA[i][2] + '-' + response.DATA[i][1];
				            		var valchecked = include(wl,wlid);
				            		var checkval = '';
				            		if (valchecked != 'undefined' && valchecked) {
				            			checkval = ' checked';
				            			}
				            		//sstr += '<li data-role="list-divider">' + response.DATA[i][3] + ' - ' + response.DATA[i][4] + '</li>';
					    			sstr += '<li>';
					    			sstr += '<h3>' + response.DATA[i][8] + ' - ' + response.DATA[i][18]  + ' - ' + response.DATA[i][3] + '</h3>';
					    			sstr += '<h5>' + response.DATA[i][11] + ' ' + response.DATA[i][12] + ' - ' + response.DATA[i][13];
					    			sstr += '<span class="ui-li-count">' + response.DATA[i][22] + '</span></h5>';
					    			sstr += '<p><input type="checkbox"' + checkval + ' value="'+ wlid +'" onclick="if ($(this).is(\':checked\')) { watchlistSave(this.value);} else { watchlistDel(this.value)};">';
					    			sstr += response.DATA[i][1] + ' ' + response.DATA[i][14];
					    			var lname = response.DATA[i][15].split(',')[0];
					    			sstr += ' - <a rel="external" href="directory-search.html?q=' + lname + '">' + response.DATA[i][15] + '</a></p>';
					    			sstr += '</li>';
			        				}
			        				
				            },
				            error: function(ErrorMsg) {
					        	alert('Error');
					    	}
					  	});
						$('#subjects').html(sstr);
				  		$('#subjects').listview("refresh");
					});	  
				  });
				  
			</script>
		</div>
		<div id="primary-nav"  class="navpage content-secondary">
			<form id='searchForm' name='searchForm' action="search.html" method="get" class="ui-body ui-body-c" data-ajax="false">
				<label for="strm" class="ui-hidden-accessible">Term:</label>
				<label for="search-basic" class="ui-hidden-accessible">Search Input:</label>
				<select name="strm" id="strm">
				</select>
				<input type="search" name="search" id="search-basic" value="" />
			</form>
		 	<script type="text/javascript">
				var tstr = '';
		    	jQuery(function($){
			    	$.ajax({
			            url: "http://test01.scu.edu/docs/ws/catalog/index.cfc?method=qTerms&ReturnFormat=json",
			            dataType: 'json',
			            async:false,
			            success: function(response) {
			            	var i;
			            	//["STRM","STRM_DESCR"]
			            	for (i = 0; i < response.DATA.length; i++) {
							tstr += '<option value="'+response.DATA[i][0]+'">'+response.DATA[i][1]+'</option>';
							}
						$('#strm').html(tstr);
			            },
			            error: function(ErrorMsg) {
				        alert('Error');
				    	}
				  	});
				  });
			</script>
			<ul data-role="listview" class="ui-listview"></ul>
			<script>
				var navstring = 'courses';
			</script>
		    <script src="assets/nav.js"></script>
		</div>
	</div>

	<div data-role="footer" id="footer">
		<p style="text-align:center;">&copy; 2013 Santa Clara University</p>
	</div><!-- /footer -->
</div><!-- /page -->

</body>
</html>