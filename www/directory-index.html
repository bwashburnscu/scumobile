<!DOCTYPE html> 
<html> 
	<head> 
	<title>Directory</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/scu.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile.structure-1.3.1.min.css" /> 
	<link rel="stylesheet" href="assets/secondary.css" />
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script> 
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script> 

	<script>
	   $(document).ready(function() {
	   	if($('#primary-nav').length == 0) {
	   		$('.pnav-icon').hide();
	   		}
	   });
   
	   
		function getUrlVars() {
		var vars = [], hash;
		var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
		for(var i = 0; i < hashes.length; i++)
		    {
		        hash = hashes[i].split('=');
		        vars.push(hash[0]);
		        vars[hash[0]] = hash[1];
		    }
		return vars;
		}
	
	</script>
   
	</head> 
<body> 

<div data-role="page" class="navpage type-interior" data-theme="a">
	
	<div data-role="header">
		<a rel="external" href="index.html" data-role="none" data-direction="reverse" class="ui-btn-left"><img width="108" height="40" class="sculogo" alt="" src="assets/scu-home.png" /></a>
		<h1>Directory</h1>
		<a href="#" onclick="$.mobile.silentScroll($.mobile.activePage.find('#primary-nav').position().top)" data-role="none" class="pnav-icon"><img alt="" src="assets/259-list-w.png" /></a>
	</div><!-- /header -->

	<div data-role="content">
    <div class="content-primary">
		<form data-ajax="false" id='searchForm' name='searchForm' action="directory-search.html" method="get" class="ui-body ui-body-d ui-corner-all">
			<fieldset>
				<label for="search-basic" class="ui-hidden-accessible">Search Input:</label>
				<script>
					var q = getUrlVars()["q"];
					if (q != 'undefined') {
						q = '';
					}
					document.write('<input type="search" name="q" id="search-basic" value="'+q+'" />');			
				</script>
			</fieldset>
		</form>

		<h3>Quick Reference</h3>
		
    	<div data-role="collapsible-set" id="qrOrgs"></div>
		
    	<script type="text/javascript">
			var qrstr = '';
			var ostr = '';
	    	jQuery(function($){
		    	$.ajax({
		            url: "http://test01.scu.edu/docs/ws/directory/index.cfc?method=quickRefs&ReturnFormat=json",
		            dataType: 'json',
		            async:false,
		            success: function(response) {
		            	var i;
		            	//["ID","NAME","PHONE","ORGEMAIL","DESCR_FULL","URL"]
			        	for (i = 0; i < response.DATA.length; i++) {
			        		var phone = response.DATA[i][2];
							if (phone.indexOf('408') == -1 && phone.length <= 8 && phone.length >= 7) {
								phone = '408-' + phone;
								}
			        		orgid = response.DATA[i][0];
							ostr += '<div data-role="collapsible" data-collapsed="false">';
							ostr += "<h3>" + response.DATA[i][1] + "</h3>";
							ostr += '<p><a href="tel:'+phone+'">'+phone+'</a></p>';
							ostr += '<p><a href="mailto:'+response.DATA[i][3]+'">'+response.DATA[i][3]+'</a></p>';
							ostr += '<div>' + response.DATA[i][4] + '</div>';
							ostr += '<p><a rel="external" href="directory-org.html?oid='+orgid+'">More info...</a></p>';
							ostr += '</div>';
						}
					$('#qrOrgs').html(ostr);
			        $('#qrOrgs').collapsibleset('refresh');
		            },
		            error: function(ErrorMsg) {
			       alert('Error');
			    	}
			  	});
			  });
		</script>
	</div>
	<div id="primary-nav" class="content-secondary">
		<ul data-role="listview" class="ui-listview" data-inset="true"></ul>
		<script>
			var navstring = 'directory';
		</script>
	    <script src="assets/nav.js"></script>
	</div>
	</div>

	<div data-role="footer" id="footer">
		<p style="text-align:center;">&copy; 2013 Santa Clara University</p>
	</div><!-- /footer -->
</div><!-- /page -->

</body>
</html>