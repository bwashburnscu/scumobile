<!DOCTYPE html> 
<html> 
	<head> 
	<title>Directory</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../assets/scu.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile.structure-1.3.1.min.css" /> 
	<link rel="stylesheet" href="../assets/secondary.css" />
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script> 
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script> 

	<script>
	   $(document).ready(function() {
	   	if($('#primary-nav').length == 0) {
	   		$('.pnav-icon').hide();
	   		}
	   });
	   
		function getUrlVars() {
		var vars = [], hash;
		var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
		for(var i = 0; i < hashes.length; i++)
		    {
		        hash = hashes[i].split('=');
		        vars.push(hash[0]);
		        vars[hash[0]] = hash[1];
		    }
		return vars;
		}
	</script>
   
	</head> 
<body> 

<div data-role="page" class="navpage type-interior" data-theme="a">
	
	<div data-role="header">
		<a rel="external" href="../index.html" data-role="none" data-direction="reverse" class="ui-btn-left"><img width="108" height="40" class="sculogo" alt="" src="../assets/scu-home.png" /></a>
		<h1>Directory</h1>
		<a href="#" onclick="$.mobile.silentScroll($.mobile.activePage.find('#primary-nav').position().top)" data-role="none" class="pnav-icon"><img alt="" src="../assets/259-list-w.png" /></a>
	</div><!-- /header -->

	<div data-role="content">
    <div class="content-primary">
		<form data-ajax="false" id='searchForm' name='searchForm' action="search.html" method="get" class="ui-body ui-body-d ui-corner-all">
			<fieldset>
				<label for="search-basic" class="ui-hidden-accessible">Search Input:</label>
				<input type="search" name="q" id="search-basic" value="" />
			</fieldset>
		</form>
		<div id="orgmain"></div>
		<div id="orgstaff" data-role="collapsible-set" data-collapsed="false" data-theme="a" data-content-theme="c"></div>
		<script type="text/javascript">
			var pstr = '';
			var ostr = '';
			var oid = getUrlVars()["oid"];
	    	jQuery(function($){
		    $.ajax({
		            url: "http://test01.scu.edu/docs/ws/directory/index.cfc?method=searchOrg&oid="+oid+"&ReturnFormat=plain",
		            async:false,
		            success: function(response) {
		            var orgname = $(response).find('name').text();
		            var orgdescr = $(response).find('descr').text();
		            var orgurl = $(response).find('url').text();
		            var orgphone = $(response).find('orgphone').text();
		            if (orgphone.indexOf('408') == -1 && orgphone.length <= 8 && orgphone.length >= 7) {
						orgphone = '408-' + orgphone;
						}
					var orgfax = $(response).find('fax').text();
					var orgbuilding = $(response).find('building').text();
					var orgaddress = $(response).find('address').text();
		            var orgloc = $(response).find('locid').text();
		            var lastperson = '';
		            ostr += '<h3>' + orgname + '</h3>';
		            if (orgdescr.length > 0) {
		            ostr += '<p>' + orgdescr + '</p>';
		            }
		          	ostr += '<div class="ui-body ui-body-c ui-corner-all">';
		            if (orgphone.length > 0) {
		            ostr += '<p><a href="tel:' + orgphone + '">' + orgphone + '</a></p>';
		            }
		            if (orgurl.length > 0) {
		            ostr += '<p><a href="' + orgurl + '">' + orgurl + '</a></p>';
		            }
		            if (orgloc.length > 0) {
		            ostr += '<p><a rel="external" href="/map/?loc_id=' + orgloc + '">Campus Map</a></p>';
		            }
		            ostr += '</div>';
		            $('#orgmain').html(ostr);
		            $(response).find('person').each(function(index) {
					     var fname = $(this).find('fname').text();
					     var prefname = $(this).find('prefname').text();
					     if(prefname.length > 0) {
					     	fname = prefname;
					     }
						 var lname = $(this).find('lname').text();
						 var title = $(this).find('title').text();
						 var phone = $(this).find('phone').text();
						 if (phone.indexOf('408') == -1 && phone.length <= 8 && phone.length >= 7) {
							phone = '408-' + phone;
							}
						 var email = $(this).find('email').text();
						 var personid = $(this).find('personid').text();
						 if (personid != lastperson) {
						 pstr += '<div data-role="collapsible">';
						 pstr += '<h4>' + lname + ', ' + fname + '</h4>';
						 pstr += '<p>' + title + '</p>';
						 pstr += '<p><a href="tel:' + phone + '">' + phone + '</a></p>';
						 pstr += '<p><a href="mailto:' + email + '">' + email + '</a></p>';
						 pstr += '</div>';
						 }
						 lastperson = personid;
						 });
					$('#orgstaff').html(pstr);
					$("#orgstaff").collapsibleset("refresh");
			    	}
			    	
			    ,
			    error: function(ErrorMsg) {
			       alert('Error');
			    }
			  });
	    });
	    </script>
	</div>
	<div id="primary-nav" class="content-secondary">
		<ul data-role="listview" class="ui-listview" data-inset="true"></ul>
		<script>
			var navstring = 'directory';
		</script>
	    <script src="../assets/nav.js"></script>
	</div>
	</div>

	<div data-role="footer" id="footer">
		<p style="text-align:center;">&copy; 2013 Santa Clara University</p>
	</div><!-- /footer -->
</div><!-- /page -->



</body>
</html>